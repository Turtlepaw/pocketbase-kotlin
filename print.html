<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pocketbase Kotlin</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="A multi-platform Kotlin SDK for Pocketbase">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Pocketbase Kotlin Docs</li><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="usage.html"><strong aria-hidden="true">2.</strong> Usage</a></li><li class="chapter-item expanded "><a href="caveats.html"><strong aria-hidden="true">3.</strong> Caveats</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="caveats-collections.html"><strong aria-hidden="true">3.1.</strong> Collections</a></li><li class="chapter-item expanded "><a href="caveats-records.html"><strong aria-hidden="true">3.2.</strong> Records</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Pocketbase Kotlin</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<h4 id="pocketbase-kotlin-is-a-multiplatform-kotlin-sdk-for-pocketbase-designed-to-be-used-both-client-and-server-side"><a class="header" href="#pocketbase-kotlin-is-a-multiplatform-kotlin-sdk-for-pocketbase-designed-to-be-used-both-client-and-server-side">Pocketbase Kotlin is a multiplatform Kotlin SDK for <a href="https://pocketbase.io">Pocketbase</a> designed to be used both client and server side.</a></h4>
<h2 id="support"><a class="header" href="#support">Support</a></h2>
<p>Pocketbase Kotlin offers support for <a href="https://github.com/pocketbase/pocketbase/releases/tag/v0.20.0">Pocketbase 0.20</a> and above.
and above.
Support for new Pocketbase releases will be added as soon as possible.</p>
<p>Currently, the following platforms are supported,</p>
<div class="table-wrapper"><table><thead><tr><th>Supported Platforms</th></tr></thead><tbody>
<tr><td>JVM</td></tr>
<tr><td>Linux (x64)</td></tr>
<tr><td>Windows (x64)</td></tr>
<tr><td>Mac OS (x64) (arm x64)</td></tr>
<tr><td>IOS (arm x64) (x64) (sim arm x64)</td></tr>
</tbody></table>
</div>
<p><em>Want a platform supported? Open an <a href="https://github.com/agrevster/pocketbase-kotlin/issues">issue</a>, and we will try our
best to add it.</em></p>
<h3 id="installing"><a class="header" href="#installing">Installing</a></h3>
<p><strong>Using this library requires the</strong>
<a href="https://github.com/Kotlin/kotlinx.serialization#using-the-plugins-block">KotlinX Serialization plugin</a></p>
<p>To use Pocketbase Kotlin just add the following into your buildscript:</p>
<pre><code class="language-kotlin">repositories {
    mavenCentral()
}

dependencies {
    implementation("io.github.agrevster:pocketbase-kotlin:2.6.2")
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<h3 id="client"><a class="header" href="#client">Client</a></h3>
<p>The <code>PocketbaseClient</code> is the class used to access the Pocketbase API.</p>
<pre><code class="language-kotlin">// Creates a new pocketbase client with the given URL
// The client is used to access everything in the Pocketbase API
val client = PocketbaseClient({
    protocol = URLProtocol.HTTP // or URLProtocol.HTTPS (recommended for production)
    host = "localhost"
    port = 8090 // (optional)
})
</code></pre>
<h3 id="logging-in"><a class="header" href="#logging-in">Logging in</a></h3>
<p>Logging the client in allows it to call methods that require Pocketbase authentication.
The current login token is saved and applied to every api request.</p>
<h4 id="auth-store"><a class="header" href="#auth-store">Auth Store</a></h4>
<p>If you want to persistently store the token, you can extend <code>BaseAuth</code> and store the token using <code>SharedPreferences</code> or another database:</p>
<pre><code class="language-kotlin">// Using SharedPreferences
const val TOKEN_KEY = "token"
class AuthStore(var sharedPreferences: SharedPreferences) : BaseAuthStore(null) {
    init {
        this.token = sharedPreferences.getString(TOKEN_KEY, null)
    }

    override fun save(token: String?) {
        super.save(token)
        sharedPreferences.edit()
            .putString(TOKEN_KEY, token)
            .apply()
    }

    override fun clear() {
        super.clear()
        sharedPreferences.edit()
            .putString(TOKEN_KEY, null)
            .apply()
    }
}
</code></pre>
<pre><code class="language-kotlin">// Set store in client settings
val client = PocketbaseClient({
    //...
}, store = AuthStore(sharedPreferences))
</code></pre>
<h4 id="logging-in-via-usernameemail-and-password"><a class="header" href="#logging-in-via-usernameemail-and-password">Logging in via username/email and password</a></h4>
<pre><code class="language-kotlin">// Logging in as an admin
client.admins.authWithPassword("email", "password").token

// Using the collection auth service to log in
// This authenticates a user rather than an admin
// The user auth service is the same as collection auth, but it uses the "users" collection
client.records.authWithPassword&lt;User&gt;("collectionName", "email", "password").token
client.records.authWithUsername&lt;User&gt;("collectionName", "username", "password").token
</code></pre>
<h4 id="logging-in-via-oauth"><a class="header" href="#logging-in-via-oauth">Logging in via OAuth</a></h4>
<pre><code class="language-kotlin">//You can also use oauth2
client.records.authWithOauth2&lt;User&gt;("collectionName", "provider", "code", "codeVerifier", "redirectUrl").token
</code></pre>
<h4 id="logging-in-via-token"><a class="header" href="#logging-in-via-token">Logging in via token</a></h4>
<pre><code class="language-kotlin">client.login { token = "xxx" }
</code></pre>
<h4 id="logging-out"><a class="header" href="#logging-out">Logging out</a></h4>
<pre><code class="language-kotlin">client.logout()
</code></pre>
<h3 id="using-the-pocketbase-api"><a class="header" href="#using-the-pocketbase-api">Using the Pocketbase API</a></h3>
<pre><code class="language-kotlin">// We are using this class to hold records created in the collection "people".
// Each record has a name (required), age (required number) and a pet optional.
// If a value is optional in the collection's schema make sure the kotlin type is nullable and defaults to null.
// All record classes must be @Serializable and extend Record.
@Serializable
data class PersonRecord(val name: String, val age: Int, val pet: String? = null): Record()

val recordToCreate = PersonRecord("Sky", 4)
// Generics are used to define the return type of API calls, just make sure that the record class you created matches the collection's schema.
val response = client.records.create&lt;PersonRecord&gt;("people", Json.encodeToString(recordToCreate))
// You can now use the data from the response.
val collectionId = response.collectionId
</code></pre>
<h4 id="types"><a class="header" href="#types">Types</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Pocketbase Type</th><th>Kotlin Type</th></tr></thead><tbody>
<tr><td>Plain text, email, rich text, Url</td><td><code>String</code></td></tr>
<tr><td>Number</td><td><code>Int</code></td></tr>
<tr><td>Bool</td><td><code>Boolean</code></td></tr>
<tr><td>Select, relation</td><td><code>List&lt;T&gt;</code></td></tr>
<tr><td>Json</td><td><code>JsonObject</code></td></tr>
</tbody></table>
</div>
<h3 id="congratulations"><a class="header" href="#congratulations">Congratulations</a></h3>
<p><strong>All done!</strong> Now that you have a Pocketbase client set up and know how to log in, the rest is easy!
Simply follow the <a href="https://pocketbase.io/docs/api-records/">Pocketbase Web API Docs</a> and our internal KDocs to find your
way around the Pocketbase API.
There are a few exceptions for which features could not be made to match the other SDKs, for a guide on them go to
our <a href="caveats.html">caveats page</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="caveats"><a class="header" href="#caveats">Caveats</a></h1>
<p>This section is dedicated to informing users of the small quirks and irregularities between Pocketbase Kotlin and
the <a href="https://pocketbase.io/docs/api-records/">official Pocketbase web API</a>.</p>
<p>There is a document for each service and their irregularities and quirks.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="caveats-in-the-collections-service"><a class="header" href="#caveats-in-the-collections-service">Caveats in the Collections Service</a></h1>
<p>Very seldom do users need to create a new collection with the API, but in the rare instances where this is necessary,
there are a couple of differences that should be noted.</p>
<h4 id="creation"><a class="header" href="#creation">Creation</a></h4>
<p>There is no need to create your own collection data class like with the record service, we helpfully provide one with
all the features need to create a collection.</p>
<h5 id="example"><a class="header" href="#example">Example:</a></h5>
<p>In this example we create the collection used in the <a href="usage.html#calling-the-pocketbase-api">usage example</a> using
Pocketbase Kotlin.</p>
<pre><code class="language-kotlin"><span class="boring">val client = PocketbaseClient({
</span><span class="boring">     protocol = URLProtocol.HTTP
</span><span class="boring">     host = "localhost"
</span><span class="boring">     port = 8090
</span><span class="boring">})
</span><span class="boring">
</span><span class="boring">client.login {
</span><span class="boring">     token = client.admins.authWithPassword("email","password").token
</span><span class="boring">}
</span><span class="boring"> 
</span>//Simply use the collection object and fill out the fields as needed
val collection = Collection(
    name = "people",
    type = Collection.CollectionType.BASE,
    schema = listOf(
        SchemaField(
            name = "name",
            type = SchemaField.SchemaFieldType.TEXT,
            required = true,
            ),
        SchemaField(
            name = "age",
            type = SchemaField.SchemaFieldType.NUMBER,
            required = true,
            options = SchemaField.SchemaOptions(
                //Some options such as min and max can different types
                //to fix this issue we serialise them as JsonPrimitives
                min = 0.toJsonPrimitive(),
                max = 150.toJsonPrimitive()
            )
        ),
        SchemaField(
            name = "pet",
            type = SchemaField.SchemaFieldType.SELECT,
            required = false,
            options = SchemaField.SchemaOptions(
                values = listOf("Dog","Cat","Bird")
            )
        )
    )
) 
//The generic '&lt;Collection&gt;' encodes our collection to JSON based on the Collection class
client.collections.create&lt;Collection&gt;(Json.encodeToString(collection))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="caveats-in-the-records-service"><a class="header" href="#caveats-in-the-records-service">Caveats in the Records Service</a></h1>
<h4 id="file-uploading"><a class="header" href="#file-uploading">File uploading</a></h4>
<p>Due to the fact that Pocketbase Kotlin is multiplatform, file uploads do not use the Java <code>File</code> class.
There is a special utility class called <code>FileUpload</code> designed specifically for this task.
Although there are some caveats to using file uploads, as the way we handle multipart form data prevents using
serialised records. Meaning that we must use a key value map of Json elements.</p>
<h5 id="example-1"><a class="header" href="#example-1">Example:</a></h5>
<pre><code class="language-kotlin"><span class="boring">val client = PocketbaseClient({
</span><span class="boring">    protocol = URLProtocol.HTTP
</span><span class="boring">    host = "localhost"
</span><span class="boring">    port = 8090
</span><span class="boring">})
</span><span class="boring">
</span><span class="boring">client.login {
</span><span class="boring">     token = client.users.authWithPassword("email","password").token
</span><span class="boring">}
</span><span class="boring">
</span>///Make sure that the field for your file is a string
//If you have multiple file uploads in your schema make it a list of strings 
@Serializable
data class FileUploadRecord(val imageFile: String, val imageDescription: String) : Record()

client.records.create&lt;FileUploadRecord&gt;(
    "fileUploadCollection",
    //A workaround to the limitations on JSON with multipart form data
    mapOf(
        "imageDescription" to "A house".toJsonPrimitive()
    ),
    //Here is where the files are uploaded from
    //Swap ByteArray(0) with the file's content as a ByteArray
    listOf(
        FileUpload("imageFile", ByteArray(0), "house.png")
    )
)
</code></pre>
<h4 id="expanding-related-fields"><a class="header" href="#expanding-related-fields">Expanding related fields</a></h4>
<pre><code class="language-kotlin"><span class="boring">val client = PocketbaseClient({ 
</span><span class="boring">    protocol = URLProtocol.HTTP
</span><span class="boring">    host = "localhost"
</span><span class="boring">    port = 8090
</span><span class="boring">})
</span><span class="boring">
</span><span class="boring">client.login { 
</span><span class="boring">    token = client.users.authWithPassword("email", "password").token
</span><span class="boring">} 
</span><span class="boring">
</span>//For this example imagine we have two collections. One that contains users...
@Serializable
data class PersonRecord(val name: String) : User()

//And one that contains their pets
//Each Pet has a name (text), owner (relation), and each Person has a name (text) 
@Serializable 
data class PetRecord(val owner: String,val name: String) : ExpandRecord&lt;PersonRecord&gt;()
//This example gets a list of pets, selects the first one and gets its owner 

val records = client.records.getList&lt;PetRecord&gt;("pets_collection",1,3, 
//This tells Pocketbase to expand the relation field of owner 
    expandRelations = ExpandRelations("owner"))

//This returns the expanded record with the field name of owner 
val owner: PersonRecord? = records.items[0].expand?.get("owner")
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
